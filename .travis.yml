language: c
sudo: required
services:
- docker
env:
  global:
  - secure: "iSIergY/VgRH2wfECNoTQFPh+BjdMMUExPS8KqQWvbSSgYMgPnfXGp8BVZkUKO1o0\
             SZ8AGHHllC1+XUZOkbYjcAzCI3S4ly9GMpgraAnxXmQOTAt3HLE+9K8e9J7Fmpizb\
             7ojLm9tYursZf9vzOv3iBlIpEM52N7BM0UQ4qeBGc="
  matrix:
  - IMAGE=ubuntu:16.04
  - IMAGE=ubuntu:14.04
script:
- docker run -it --name sub.sh -v "$PWD/sub.sh:/sub.sh" "$IMAGE" /sub.sh
- docker start -ia sub.sh
after_success:
- |
  if [[ "$TRAVIS_JOB_NUMBER" != *.1 ]]
  then
    echo "sub.sh deployment skipped."
    exit 0
  fi
- |
  rm -rf .gh-pages
  mkdir .gh-pages
  cd .gh-pages
- |
  echo sub.sh > CNAME
  touch .nojekyll
  python ../web/build.py .
- |
  export REPO="https://$GITHUB_TOKEN@github.com/sublee/sub.sh"
  git init
  git config user.name "Heungsub Lee"
  git config user.email "sub@subl.ee"
  git add .
  git commit -m "Deploy to https://sub.sh/ ($TRAVIS_COMMIT)"
  git push -qf "$REPO" master:gh-pages > /dev/null 2>&1
